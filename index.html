<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SCO-AE Secure Node</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oxanium&display=swap');
    </style>
    <style>
        .oxanium {
            font-family: "Oxanium", monospace;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
        }

        body {
            background-color: #111;
            color: #c8c8c8;
/*            font-family: 'Courier New', monospace;*/
        }

        .classified-banner {
            background-color: #dc3545;
            color: #fff;
            padding: 0.5rem;
            text-align: center;
            letter-spacing: 2px;
            font-weight: bold;
        }

        .main-container {
            padding: 2rem;
        }

        .title {
            color: #00ffcc;
            font-weight: bold;
            text-transform: uppercase;
        }

        .subtext {
            font-size: 0.9rem;
            color: #999;
        }

        .terminal-box {
            background-color: #000;
            padding: 1rem;
            border: 1px solid #00ffcc;
            border-radius: 5px;
            margin-top: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.5rem;
            white-space: pre-wrap;
            height: 400px;
            overflow-y: auto;
        }

        input.terminal-input {
            background-color: #000;
            color: #0f0;
            border: none;
            border-bottom: 1px solid #00ffcc;
            width: 100%;
            outline: none;
/*            font-family: 'Courier New', monospace;*/
        }

        .footer {
            margin-top: 3rem;
            font-size: 0.8rem;
            color: #666;
            text-align: center;
        }

        .user-content {
            display: none;
            margin-top: 1.5rem;
            background-color: #1a1a1a;
            padding: 1rem;
            border-left: 4px solid #00ffcc;
        }
    </style>
</head>
<body>
    <div class="classified-banner oxanium">
        EU CONFIDENTIAL ACCESS – SCO-AE SECURE NODE
    </div>

    <div class="container main-container oxanium">
        <h1 class="title">Special Coordination Office for Anomalous Events</h1>
        <p class="subtext">Directorate-General for Home Affairs · EUROSUR · FRONTEX</p>

        <div class="terminal-box oxanium" id="terminal"></div>
        <input type="text" id="commandInput" class="terminal-input oxanium" placeholder="> waiting for user login..." disabled />

        <div class="footer">
            &copy; 2025 European Union · SCO-AE · Analysis Division · Project JANUS
        </div>
    </div>

    <script src="Scripts/sourcedata.js"></script>
    <script>
        "use strict";
        const terminal = document.getElementById("terminal");
        const input = document.getElementById("commandInput");

        let loginStep = 0;
        let loginUser = "";
        let authenticated = false;
        let user = null;

        function handleCommand(inputText) {
            if (loginStep === 1 && !authenticated) {
                var passText = "";
                for (var i = 0; i < inputText.length; i++) {
                    passText += "*";
                }
                appendLine("> " + passText, "#0f0");
            } else {
                appendLine("> " + inputText, "#0f0");
            }

            if (!authenticated) {
                if (loginStep === 0) {
                    loginUser = inputText.trim();
                    appendLine("Username: " + loginUser);
                    appendLine("Enter password:");
                    loginStep = 1;
                } else if (loginStep === 1) {
                    const password = inputText.trim();
                    appendText(["Authenticating...", 4500]);
                    setTimeout(() => {
                        if (!data || !data.users) return console.error("Data not ready");

                        if (data.users[loginUser] && data.users[loginUser].password === password) {
                            appendLine("[ACCESS GRANTED]", "#0f0");
                            user = data.users[loginUser];
                            authenticated = true;
                            input.placeholder = "> enter command";
                            appendIntro();
                        } else {
                            appendLine("[ACCESS DENIED]", "#f33");
                            loginStep = 0;
                            loginUser = "";
                            input.placeholder = "> waiting for user login...";
                        }
                    }, 5000);
                }
            } else {
                var fullString = inputText.trim().toLowerCase();
                var args = fullString.split(" ");

                var output = processCommand(args, data.commands, user.clearance);
                if (!output) {
                    appendLine("[ERROR] Command not found.");
                } else {
                    appendText(output);
                }
            }
        }

        function processCommand(args, tree, userClearance, clearanceError = "[ACCESS DENIED] Insufficient security clearance level.") {
            if (!args.length) return null;

            const [current, ...rest] = args;

            for (const node of tree) {
                if (node.keyword === current) {
                    // Check user clearance
                    if (userClearance < node.clearance) {
                        return clearanceError;
                    }

                    // Terminal response
                    if (node.response && (!node.subcommands || !node.subcommands.length)) {
                        return typeof node.response === "function"
                            ? node.response(rest)
                            : node.response;
                    }

                    // Node has subcommands, recurse
                    if (node.subcommands) {
                        const result = processCommand(rest, node.subcommands, userClearance, clearanceError);
                        return result !== null ? result : node.error;
                    }
                }
            }

            // No matching keyword found at this tree level
            return null;
        }

        function appendText(inputLines) {
            const stutter_power = 5;
            const spinnerFrames = ["|", "/", "-", "\\"];
            let latency = 0;
            let currentLine = null;

            const lines = [].concat(inputLines);

            lines.forEach((line, index) => {
                const isDelay = typeof line === "number";
                const delay = 100 * index + latency;

                if (!isDelay) {
                    setTimeout(() => {
                        currentLine = appendLine(line); // store the line element
                    }, delay);

                    const rng = Math.random() * 1000;
                    const modifier = Math.floor(Math.pow(rng, 1 / stutter_power) * stutter_power);
                    latency += modifier;
                } else {
                    setTimeout(() => {
                        if (!currentLine) return;

                        let spinnerIndex = 0;
                        const originalText = currentLine.textContent;
                        const spinnerInterval = 200;
                        let elapsed = 0;

                        const spinner = setInterval(() => {
                            currentLine.textContent = `${originalText} ${spinnerFrames[spinnerIndex % spinnerFrames.length]}`;
                            spinnerIndex++;
                            elapsed += spinnerInterval;

                            if (elapsed >= line) {
                                clearInterval(spinner);
                                currentLine.textContent = `${originalText} Done!`;
                            }
                        }, spinnerInterval);
                    }, delay);

                    latency += line;
                }
            });
        }

        function appendLine(text = " ", color = "#ccc") {
            const line = document.createElement("div");
            line.textContent = text;
            line.style.color = color;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
            return line; // Return the DOM element for later manipulation
        }

        function appendIntro() {
            const beginIntro = [
                "Accessing node (SCO-AE-INT-01)...",
                3000,
                "Estabilishing secure connection (AES-512)...",
                4000,
                "Handshake complete. Session initialized.",
                " ",
            ]
            const followIntro = [
                " ",
                "> This is a secure node of the Special Coordination Office for Anomalous Events.",
                "> This system is classified under EU Council Security Regulations. ",
                "> Unauthorized access constitutes a breach of EU cybersecurity and defense law.",
                " ",
                " ",
                "Project JANUS / System AURELIS / AE Monitoring / Incident Logs / Memetic Safety Protocols / Our Staff"
            ]

            var fullIntro = beginIntro.concat(user.intro, followIntro);
            appendText(fullIntro);
        }

        input.addEventListener("keydown", function (e) {
            if (e.key === "Enter") {
                const command = input.value.trim();
                input.value = "";
                handleCommand(command);
            }
        });

        window.onload = () => {
            appendLine(data.loginBanner, "#00ffcc");
            appendLine("Enter username:");
            input.disabled = false;
            input.focus();
        };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
