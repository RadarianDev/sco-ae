<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SCO-AE Secure Node</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            background-color: #111;
            color: #c8c8c8;
            font-family: 'Courier New', monospace;
        }

        .classified-banner {
            background-color: #dc3545;
            color: #fff;
            padding: 0.5rem;
            text-align: center;
            letter-spacing: 2px;
            font-weight: bold;
        }

        .main-container {
            padding: 2rem;
        }

        .title {
            color: #00ffcc;
            font-weight: bold;
            text-transform: uppercase;
        }

        .subtext {
            font-size: 0.9rem;
            color: #999;
        }

        .terminal-box {
            background-color: #000;
            padding: 1rem;
            border: 1px solid #00ffcc;
            border-radius: 5px;
            margin-top: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.5rem;
            white-space: pre-wrap;
            height: 400px;
            overflow-y: auto;
        }

        input.terminal-input {
            background-color: #000;
            color: #0f0;
            border: none;
            border-bottom: 1px solid #00ffcc;
            width: 100%;
            outline: none;
            font-family: 'Courier New', monospace;
        }

        .footer {
            margin-top: 3rem;
            font-size: 0.8rem;
            color: #666;
            text-align: center;
        }

        .user-content {
            display: none;
            margin-top: 1.5rem;
            background-color: #1a1a1a;
            padding: 1rem;
            border-left: 4px solid #00ffcc;
        }
    </style>
</head>
<body>
    <div class="classified-banner">
        EU CONFIDENTIAL ACCESS – SCO-AE SECURE NODE
    </div>

    <div class="container main-container">
        <h1 class="title">Special Coordination Office for Anomalous Events</h1>
        <p class="subtext">Directorate-General for Home Affairs · EUROSUR · FRONTEX</p>

        <div class="terminal-box" id="terminal"></div>
        <input type="text" id="commandInput" class="terminal-input" placeholder="> waiting for user login..." disabled />

        <div class="footer">
            &copy; 2025 European Union · SCO-AE · Analysis Division · Project JANUS
        </div>
    </div>

    <script src="Scripts/sourcedata.js"></script>
    <script>
        const terminal = document.getElementById("terminal");
        const input = document.getElementById("commandInput");

        let loginStep = 0;
        let loginUser = "";
        let authenticated = false;
        let user = null;

        function appendLine(text = "", color = "#ccc") {
            const line = document.createElement("div");
            line.textContent = text;
            line.style.color = color;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function handleCommand(inputText) {
            appendLine("> " + inputText, "#0f0");

            if (!authenticated) {
                if (loginStep === 0) {
                    loginUser = inputText.trim();
                    appendLine("Username: " + loginUser);
                    appendLine("Enter password:");
                    loginStep = 1;
                } else if (loginStep === 1) {
                    const password = inputText.trim();
                    appendLine("Authenticating...");
                    setTimeout(() => {
                        if (!data || !data.users) return console.error("Data not ready");

                        if (data.users[loginUser] && data.users[loginUser].password === password) {
                            appendLine("[ACCESS GRANTED]", "#0f0");
                            user = data.users[loginUser];
                            authenticated = true;
                            input.placeholder = "> ";
                            appendIntro();
                        } else {
                            appendLine("[ACCESS DENIED]", "#f33");
                            loginStep = 0;
                            loginUser = "";
                            input.placeholder = "> Enter username:";
                        }
                    }, 5000);
                }
            } else {
                var fullString = inputText.trim().toLowerCase();
                var args = fullString.split(" ");

                var output = processCommand(args, data.commands, user.clearance);
                if (!output) {
                    appendLine("[ERROR] Command not found.");
                } else {
                    appendText(output);
                }
            }
        }

        function processCommand(args, tree, userClearance, clearanceError = "[ACCESS DENIED] Insufficient security clearance level.") {
            if (!args.length) return null;

            const [current, ...rest] = args;

            for (const node of tree) {
                if (node.keyword === current) {
                    // Check user clearance
                    if (userClearance < node.clearance) {
                        return clearanceError;
                    }

                    // Terminal response
                    if (node.response && (!node.subcommands || !node.subcommands.length)) {
                        return typeof node.response === "function"
                            ? node.response(rest)
                            : node.response;
                    }

                    // Node has subcommands, recurse
                    if (node.subcommands) {
                        const result = processCommand(rest, node.subcommands, userClearance, clearanceError);
                        return result !== null ? result : node.error;
                    }
                }
            }

            // No matching keyword found at this tree level
            return null;
        }

        function appendText(inputLines) {
            let latency = 0;
            const stutter_power = 2;

            var lines = [].concat(inputLines);

            lines.forEach((line, i) => {
                const delay = 100 * i + latency;
                setTimeout(() => {
                    appendLine(line);
                }, delay);

                var rng = Math.random() * 1000;
                var modifier = Math.floor(Math.pow(rng, 1 / stutter_power) * stutter_power);
                latency += modifier;
            });
        }


        function appendIntro() {
            appendText(user.intro);
        }

        input.addEventListener("keydown", function (e) {
            if (e.key === "Enter") {
                const command = input.value.trim();
                input.value = "";
                handleCommand(command);
            }
        });

        window.onload = () => {
            appendLine(data.loginBanner, "#00ffcc");
            appendLine("Enter username:");
            input.disabled = false;
            input.focus();
        };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
